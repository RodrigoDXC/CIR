<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>general</category>
        <client_script><![CDATA[$j( document ).ready(function(){
	$j('#table').on('change', function() {
		
			$j('#fields')
			.find('option')
			.remove()
			.end()
			.append('<option value="none">${gs.getMessage("None")}</option>>')
			.val('none');
		if(this.value != 'none') {
			var ga = new GlideAjax('CIRSituationUtilsClient');
			ga.addParam('sysparm_name', 'getFields');
			ga.addParam('sysparm_table_name', this.value);
			ga.getXML(getIt);
		}
	});
	
	$j("#add_tag").click(function() {
	
		if($j('#fields').val() != 'none') {
			var type = g_form.getValue('type');
			if(type == 'email') {
				var newBody = g_form.getValue('body') + ' #{' + $j('#fields').val()+'}';
				g_form.setValue('body', newBody);

			} else if(type != '') {
				var newPlain = g_form.getValue('plain_text') + ' #{' + $j('#fields').val()+'}';
				g_form.setValue('plain_text', newPlain);
			} 
		}
		GlideModal.get().destroy();
	});
	
});

function getIt(response) {
	var answer = JSON.parse(response.responseXML.documentElement.getAttribute("answer"));
	
	for(var i = 0; i< answer.length; i++) {
		$j('#fields').append($j('<option>', { value : answer[i].value }).text(getMessage(answer[i].label)));
	}
}
]]></client_script>
        <description/>
        <direct>false</direct>
        <endpoint>x_fru_cir_add_field_tag.do</endpoint>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
	<div style="padding:10px">
		<g:ui_choice_input_field  id="table" name="table" label="${gs.getMessage('Select Table')}">
			<option value="none">${gs.getMessage('None')}</option>
			<option value="x_fru_cir_situation">${gs.getMessage('Situation')}</option>
			<option value="x_fru_cir_response_plan_execution">${gs.getMessage('Response plans')}</option>
		</g:ui_choice_input_field>
	</div>	
	
	<div style="padding:10px">
		<g:ui_choice_input_field  id="fields" name="fields" label="${gs.getMessage('Select field')}">
			<option value="none">${gs.getMessage('None')}</option>
		</g:ui_choice_input_field>	
	</div>
	<div style="float: right;" >
		<button id="add_tag" class="btn-primary">${gs.getMessage('Add tag')}</button>
		<button onclick="GlideModal.get().destroy()">${gs.getMessage('Cancel')}</button>	
	</div>
	<style>
		select {
			width: 170px;
		}
	</style>	
	
</j:jelly>]]></html>
        <name>add_field_tag</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>hugo.reis</sys_created_by>
        <sys_created_on>2020-03-25 08:49:27</sys_created_on>
        <sys_id>e68082091b330850df7e43f4bd4bcbc3</sys_id>
        <sys_mod_count>4</sys_mod_count>
        <sys_name>add_field_tag</sys_name>
        <sys_package display_value="Corporate Incident Response" source="x_fru_cir">265c101f13ab44100b8670a76144b0a2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Corporate Incident Response">265c101f13ab44100b8670a76144b0a2</sys_scope>
        <sys_update_name>sys_ui_page_e68082091b330850df7e43f4bd4bcbc3</sys_update_name>
        <sys_updated_by>hugo.reis</sys_updated_by>
        <sys_updated_on>2020-03-30 14:44:56</sys_updated_on>
    </sys_ui_page>
</record_update>
