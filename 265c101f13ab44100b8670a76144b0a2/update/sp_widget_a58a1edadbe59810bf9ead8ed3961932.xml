<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($rootScope, $scope, $timeout, $location, $log, $window, spUtil, nowAttachmentHandler, spAriaUtil, spNavStateManager) {

	var c = this;
	$scope.submitting = false;
	$scope.mandatory = [];
	$scope.errorMessages = [];
	$scope.data.show_sql = false;
	$scope.saveButtonSuffix = spUtil.getAccelerator('s');
	$scope.isPageReady = false;
	$scope.adminMenu = {
		encodedPageUrl: encodeURIComponent($location.url()),
		getClientScriptCount: function() {
			var count = 0;
			if ($scope.data.f.client_script) {
				count += $scope.data.f.client_script.onChange.length;
				count += $scope.data.f.client_script.onLoad.length;
				count += $scope.data.f.client_script.onSubmit.length;
			}
			return count;
		}
	};

	spUtil.recordWatch($scope, c.data.table, "sys_id=" + c.data.sys_id, function(name, data) {
		c.server.update();
	});

	$rootScope.$on('$sp.html.editor.progress', function(e, conf) {
		$scope.submitting = conf.state;
	});

	$scope.getButtonClass = function(action) {
		if (action.form_style == "destructive")
			return "btn-danger";

		if (action.form_style == "primary")
			return "btn-primary";

		return "btn-default";
	};

	$scope.getUIActions = function(type) {
		if ($scope.data.disableUIActions)
			return [];
		if (type) {
			return $scope.data.f._ui_actions.filter(function(action) {
				//We handle the primary action button separately.
				return !action.primary && action['is_' + type];
			});
		} else {
			return $scope.data.f._ui_actions;
		}
	}

	$scope.getPrimaryAction = function() {
		var primaryActions = $scope.data.f._ui_actions.filter(function(action) {
			return action.primary;
		});
		return (primaryActions.length) ? primaryActions[0] : null;
	}

	$scope.getUIActionContextMenu = function(event) {
		var menu = [];
		if (event.ctrlKey)
			return menu;

		var contextActions = $scope.getUIActions('context');
		contextActions.forEach(function(action) {
			menu.push([action.name, function() {
				$scope.triggerUIAction(action);
			}]);
		});

		if (contextActions.length > 0)
			menu.push(null);
		menu.push([$scope.data.exportPDFMsg, function() {
			exportPDF("");
		}]);
		menu.push([$scope.data.exportPDFLandMsg, function() {
			exportPDF('true');
		}]);

		return menu;
	}

	function exportPDF(landscape) {
		$window.open("/" + $scope.data.f.table + ".do?PDF&landscape=" + landscape + "&sys_id=" + $scope.data.sys_id + "&sysparm_view=" + $scope.data.f.view);
	}

	//trigger the primary UI Action on save (if there is one)
	var deregister = $scope.$on('$sp.save', function() {
		var primaryAction = $scope.getPrimaryAction();
		if (primaryAction)
			$scope.triggerUIAction(primaryAction);
	});
	$scope.$on('$destroy', function() {
		deregister()
	});

	$scope.triggerUIAction = function(action) {
		if ($scope.data.disableUIActions && !action.primary) {
			return;
		}
		$rootScope.$broadcast('sp.form.ui_action.triggered');

		var activeElement = document.activeElement;
		if (activeElement) {
			activeElement.blur();
		}

		$scope.$evalAsync(function() {
			if (g_form) {
				$scope.submitting = true;
				if (!g_form.submit(action.action_name || action.sys_id))
					$scope.submitting = false;
			}
		});
	}

	$scope.$on("spModel.uiActionComplete", function(evt, response) {
		$scope.submitting = false;
		var sysID = (response.isInsert) ? response.sys_id : $scope.data.sys_id;
		var message;
		var fail = response.$$uiNotification[0];

		if (!fail || fail.type != 'error') {
			if (response.isInsert) {
				message = $scope.data.recordAddedMsg;
				$scope.server.update();
			} else
				message = $scope.data.updatedMsg;
			$scope.status = message;
			spUtil.addTrivialMessage(message);
			$timeout(clearStatus, 2000);
			try {
				$scope.$parent.$dismiss();
			} catch (e) {}

			return;
		}
	});

	var ctrl = this;
	// switch forms
	var unregister = $scope.$on('$sp.list.click', onListClick);
	$scope.$on("$destroy", function() {
		unregister();
	})

	function _save() {
		var primaryAction = $scope.getPrimaryAction();
		if (primaryAction)
			$scope.triggerUIAction(primaryAction);
	}

	function onListClick(evt, arg) {
		loadForm(arg.table, arg.sys_id);
	}

	function loadForm(table, sys_id) {
		var f = {};
		$scope.data.table = f.table = table;
		$scope.data.sys_id = f.sys_id = sys_id;
		f.view = $scope.data.view;

		return $scope.server.update().then(setupAttachmentHandler);
	}

	function openRelatedList(e, queryString) {
		// todo: Open this in a modal
		$location.search(queryString);
		e.preventDefault();
	}

	$scope.$on('spModel.fields.rendered', function() {
		if (ctrl.panels)
			ctrl.panels.removeClass('shift-out').addClass('shift-in');
	});

	var g_form;

	function initForm(gFormInstance) {
		//following line is presenting the buttons on the modal window
		//instead of presenting in the form footer
		$('#buttons').appendTo('.modal-footer');

		if (gFormInstance.getTableName() == $scope.data.f.table) {
			g_form = gFormInstance;

			if ($scope.data.parentRecord) {
				g_form.setValue('incident', $scope.data.parentRecord);
			}

			if (g_form.getValue('state') == '2') {
				g_form.setReadOnly('message_type', true);
				g_form.setReadOnly('message', true);
				g_form.setReadOnly('msg_subject', true);
				g_form.setReadOnly('body', true);
				g_form.setReadOnly('message', true);
				g_form.setReadOnly('contact_list', true);
			}
			if (g_form.getValue('notifications_sent') == "true" && g_form.getValue('task_type') == "message" && g_form.getValue('state') != "1") {
				g_form.setReadOnly('message_type', true);
				g_form.setReadOnly('message', true);
				g_form.setReadOnly('msg_subject', true);
				g_form.setReadOnly('body', true);
				g_form.setReadOnly('message', true);
				g_form.setReadOnly('contact_list', true);
			}
			//When opening a new task record, this will fill in the crisis field
			if ($scope.data.table == 'x_fru_cir_situation_task_execution') {
				g_form.setValue('situation', $scope.data.crisis);
				g_form.setValue('dimension', $scope.data.dimension);
				g_form.setReadOnly('situation', true);
				g_form.setVisible('dimension', false);
				g_form.setVisible('message_template', false);
				if (!$scope.data.crisis) {
					//g_form.setVisible('situation', false);
				}
			}

			spNavStateManager.register($scope.data.table, _save, g_form);
			$scope.isPageReady = true;
			$timeout(function() {
				$rootScope.$emit('spModel.gForm.rendered', g_form);

				if ($scope.data.parentRecord == '') {
					$rootScope.$broadcast('sendingGForm', g_form);
				}
			}, 175);
		}

		//TASK EXECUTIONS ACTIONS

		if (g_form.getValue('notifications_sent') == 'true' && g_form.getValue('task_type') == "message" && g_form.getValue('state') != '1') {
			c.showMessageDetails = true;
		} else {
			c.showMessageDetails = false;
		}

		if (g_form.getValue('state') == '3' || g_form.getValue('state') == "4") {
			c.hideAllButtons = true;
		} else {
			c.hideAllButtons = false;
		}

		if (c.data.table == 'x_fru_cir_situation_task_execution') {
			if (g_form.getValue('task_type') == 'action') {
				c.hideSendMessage = true;
			} else if (g_form.getValue('task_type') == 'message') {
				if (g_form.getValue('notifications_sent') == 'true' && g_form.getValue('state') != '1') {
					c.hideSendMessage = true;
				} else {
					c.hideSendMessage = false;
				}
			}
		}
	}

	$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {
		initForm(gFormInstance);
	});

	$scope.$on('spModel.gForm.env.created', function(e, gFormInstance) {
		initForm(gFormInstance);
	});

	// update the comments or worknotes based on activity stream
	$scope.$on("activity_stream_is_changed", function(event, data) {
		if (g_form && g_form.hasField(data.fieldName)) {
			g_form.setValue(data.fieldName, data.input);
			if (data.fieldToClear != "" && g_form.hasField(data.fieldToClear))
				g_form.setValue(data.fieldToClear, "");
		}
	})

	// Show or hide related lists
	$scope.$watch('data.f._related_lists', function() {
		$scope.data.hideRelatedLists = hideRelatedLists();
	}, true);

	function hideRelatedLists() {
		if (!$scope.data.f._related_lists)
			return true;

		if ($scope.options.hideRelatedLists == true)
			return true;

		if ($scope.data.sys_id == '-1')
			return true;

		// If all related lists are visible=false then hide
		if ($scope.data.f._related_lists.length > 0) {
			for (var i in $scope.data.f._related_lists) {
				var list = $scope.data.f._related_lists[i];
				if (list.visible) {
					return false;
				}
			}
		}
		return true;
	}

	function clearStatus() {
		$scope.status = "";
	}

	function setupAttachmentHandler() {
		$scope.attachmentHandler = new nowAttachmentHandler(appendDone, appendError);

		$scope.$evalAsync(function() {
			$scope.attachmentHandler.setParams($scope.data.table, $scope.data.f._attachmentGUID, 1024 * 1024 * $scope.data.maxAttachmentSize);
		});

		$scope.$on('dialog.upload_too_large.show', function(e) {
			$log.error($scope.data.largeAttachmentMsg);
			spUtil.addErrorMessage($scope.data.largeAttachmentMsg);
		});
	}
	setupAttachmentHandler();

	function appendDone() {
		// don't know here whether upload succeeded, so can't show msg either way
		$scope.$broadcast("sp.attachments.update", $scope.data.f._attachmentGUID);
		spAriaUtil.sendLiveMessage($scope.data.attachmentSuccessMsg);
	}

	function appendError(error) {
		$scope.errorMessages.push(error);
		spUtil.addErrorMessage(error.msg + error.fileName);
	}

	if ($scope.data.f.title) {
		$scope.$emit('sp.widget-modal.set-aria-label', $scope.data.f.title);
	}

	c.closeTask = function() {
		var obj = {};
		obj.closeTask = true;
		obj.taskId = g_form.getUniqueValue();

		c.server.get(obj).then(function() {
			spUtil.update($scope);
		})
	}

	c.saveAndStay = function() {
		var obj = {};
		obj.action = 'saveAndStay';
		obj.name = g_form.getValue('name');
		obj.crisis = g_form.getValue('situation');
		obj.dimension = g_form.getValue('dimension');
		obj.task_type = g_form.getValue('task_type');
		obj.state = g_form.getValue('state');
		obj.assigned_to = g_form.getValue('assigned_to');
		obj.description = g_form.getValue('description');
		obj.custom_message = g_form.getValue('custom_message');
		obj.message_type = g_form.getValue('message_type');
		obj.contact_list = g_form.getValue('contact_list');
		obj.message_template = g_form.getValue('message_template');
		obj.template_name = g_form.getValue('template_name');
		obj.message = g_form.getValue('message');
		obj.body = g_form.getValue('body');
		obj.msg_subject = g_form.getValue('msg_subject');
		obj.notifications_sent = g_form.getValue('notifications_sent');
		obj.sys_id = g_form.getUniqueValue();
		c.server.get(obj).then(function(r) {
		})
	}

	c.sendMessage = function() {
		var obj = {};
		obj.sendMessage = true;
		obj.table = c.data.table;
		obj.message_type = g_form.getValue('message_type');
		obj.contact_list = g_form.getValue('contact_list');
		obj.sys_id = g_form.getUniqueValue();
		obj.subject = g_form.getValue('msg_subject');
		//obj.crisis = $scope.data.criris;
		//obj.dimension = $scope.data.dimension;
		if (obj.message_type == 'email') {
			obj.body = g_form.getValue('body');
		} else {
			obj.body = g_form.getValue('message');
		}

		c.server.get(obj).then(function(resp) {
			if (resp.data.info_message) {
				g_form.addInfoMessage(resp.data.info_message); // displays info message
			}
			g_form.setValue('notifications_sent', true); // sets the values
			g_form.setValue('state', '4');
			_save();
		});
	}
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.btn-form-menu {&#13;
	vertical-align: inherit;&#13;
  padding: inherit;&#13;
  background: none;&#13;
}&#13;
&#13;
.add-on &gt; button.lookup {&#13;
   display:none;&#13;
}&#13;
&#13;
.add-on.ng-scope {&#13;
   display:none;&#13;
}&#13;
&#13;
.field-has-reference .reference {&#13;
  word-wrap: break-word;&#13;
       display: block;&#13;
  min-width:100%;&#13;
}&#13;
&#13;
.panel-title {&#13;
  word-wrap: break-word;&#13;
}&#13;
&#13;
.panel-heading {&#13;
  .dropdown-menu {&#13;
    a {&#13;
      white-space: normal;&#13;
    }&#13;
  }&#13;
}&#13;
&#13;
.sc-field-error-label {&#13;
  margin-right: .5em;&#13;
  display: inline-block;&#13;
  background-color: $sc-field-error-color;&#13;
}&#13;
&#13;
.comment {&#13;
	font-weight: bold;&#13;
	margin-top: 2px;&#13;
	margin-bottom: 2px;&#13;
}&#13;
.mce-panel, .mce-btn {&#13;
	background-image: none;&#13;
	background-color: #f0f3f4;&#13;
}&#13;
&#13;
.action-btn {&#13;
  margin-right: 5px;&#13;
}&#13;
&#13;
.timeline-container {&#13;
   max-height: 50vh;&#13;
   height: 100%;&#13;
   overflow-y: auto;&#13;
}&#13;
&#13;
.panel .panel {&#13;
    height: auto !important;&#13;
}&#13;
&#13;
.attachment-button {&#13;
  .glyphicon-paperclip {&#13;
    font-size: 18px;&#13;
  }&#13;
}&#13;
&#13;
.dropdown {&#13;
  .glyphicon-menu-hamburger:focus {&#13;
 		outline: thin dotted;&#13;
		outline: 5px auto $input-border-focus;&#13;
		outline-offset: -2px; &#13;
	}&#13;
}&#13;
&#13;
.empty-state-wrapper {&#13;
  width: 100%;&#13;
  height: 100%;&#13;
  align-items: center;&#13;
  display: flex;&#13;
  flex-direction: column;&#13;
  padding: 10vh 20px 20px;&#13;
&#13;
  .empty-state {&#13;
    border: 1px solid #e7e9eb;&#13;
    border-radius: 10px;&#13;
    max-width: 700px;&#13;
    padding: 30px 40px 20px;&#13;
    position: relative;&#13;
&#13;
    .empty-state-badge {&#13;
      top: -36px;&#13;
      left: 50%;&#13;
      position: absolute;&#13;
      height: 72px;&#13;
      width: 72px;&#13;
      -webkit-align-items: center;&#13;
      -ms-flex-align: center;&#13;
      align-items: center;&#13;
      border-radius: 100%;&#13;
      color: #ffffff;&#13;
      display: -webkit-flex;&#13;
      display: -ms-flexbox;&#13;
      display: flex;&#13;
      font-size: 40px;&#13;
      -webkit-justify-content: center;&#13;
      -ms-flex-pack: center;&#13;
      justify-content: center;&#13;
      margin-left: -36px;&#13;
      text-align: center;&#13;
    }&#13;
&#13;
    .empty-state-header {&#13;
      font-size: 30px;&#13;
      text-align: center;&#13;
      color: #343d47;&#13;
    }&#13;
&#13;
    .empty-state-content {&#13;
      ul {&#13;
        list-style: disc outside;&#13;
        margin: 0 0 10px 0;&#13;
        padding: 0 0 0 30px;&#13;
      }&#13;
    }&#13;
  }&#13;
}&#13;
&#13;
.text-success-alt {&#13;
	background-color: $state-success-text;&#13;
}&#13;
&#13;
.text-info-alt {&#13;
	background-color: $state-info-text;&#13;
}&#13;
&#13;
.btn-secondary {&#13;
	margin-right: 10px;&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>cir_sit_form</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>CIR Form (Security Process)</name>
        <option_schema>[{"name":"view","section":"Data","label":"View","type":"string"}]</option_schema>
        <public>false</public>
        <roles>x_fru_cir.cir_base</roles>
        <script><![CDATA[// form functionality - URL parameter driven
(function () {

	// populate the 'data' variable
	data.recordAddedMsg = gs.getMessage("cir_sit_record_added");
	data.updatedMsg = gs.getMessage("cir_sit_updated");
	data.emptyStateTemplate = options.empty_state_template;
	data.disableUIActions = options.disableUIActions === "true";
	data.hideRelatedLists = options.hideRelatedLists || false;
	data.labels = [];
	data.distributionList = [];
	data.messageSent = "";
	data.tables = CIRConstants.Tables;

	data.table = input ? input.table : $sp.getParameter("table");
	data.sys_id = input ? input.sys_id : $sp.getParameter("sys_id") || -1;
	data.view = input ? input.view : options.view;
	data.parentRecord = input ? input.parentId : '';
	data.f = {};

	/**TASK**/
	if (input && input.crisis && input.sys_id == '-1') {
		data.dimension = input.dimension;
		data.crisis = input.crisis;
		data.newRecord = input.sys_id === '-1';
	} else {
		data.crisis = input ? input.crisis :'';
		data.newRecord = false;
		if (data.table == data.tables.TASK_EXECUTION) {
			getDistribuitionList();
			data.labels.push(gs.getMessage('cir_sit_name'));
		}
	}

	if (input && input.action == 'saveAndStay') {
		saveAndStay(input);
	}

	if (input && input.closeTask) {
		closeTask(input.taskId);
	}

	if (input && input.sendMessage) {
		sendMessage(input);
	}

	if (data.table && data.sys_id) {
		data.isValid = true;
	} else {
		return;
	}

	data.f = $sp.getForm(data.table, data.sys_id, '', data.view);

	/* function called when the Close Task button is clicked
	 *  changes the vlaue of the state field to closed
	 *  @param {string} taskId - sys_id of the task that will be updated
	 */
	function closeTask(taskId) {
		var grExecTask = new GlideRecordSecure(data.tables.TASK_EXECUTION);

		if (grExecTask.get(taskId)) {
			grExecTask.setValue('state', 4);
			grExecTask.update();
		}
	}

	function saveAndStay(obj) {
		var grTaskSave = new GlideRecordSecure(data.tables.TASK_EXECUTION);

		if (grTaskSave.get(obj.sys_id)) {
			setValuesTasks(grTaskSave, obj);
			grTaskSave.update();
		} else {
			grTaskSave.initialize();
			setValuesTasks(grTaskSave, obj);
			grTaskSave.insert();
		}
	}

	function setValuesTasks(grTaskSave, obj) {
		if (obj.sys_id == "-1") {
			grTaskSave.setValue('situation', obj.crisis);
			grTaskSave.setValue('dimension', obj.dimension);
		}
		delete obj.sys_id;
		delete obj.crisis;
		delete obj.dimension;
		for (var i in obj) {
			// this is boolean
			if (i == 'nofitications_sent') {
				obj[i] = obj[i] == 0? false : true;
			} else if (i == 'name') {
				grTaskSave[i] = obj[i];
				continue;
			}
			grTaskSave.setValue(i, obj[i]);
		}
	}


	function getDistribuitionList() {
		var grTask = new GlideRecordSecure(data.tables.TASK_EXECUTION);
		grTask.addQuery('sys_id', data.sys_id);
		grTask.query();
		if (grTask.next()) {
			var crisisUtils = new CIRSituationUtils();
			var recipients = crisisUtils.GetUnverifiedContacts(grTask.contact_list);
		}

		var recipientsInfo = [];
		for (var i = 0; i < recipients.length; i++) {
			var tempRecipInfo = crisisUtils.GetUserInfo(recipients[i]);
			if (tempRecipInfo.name || tempRecipInfo.email) {
				recipientsInfo.push(tempRecipInfo);
			}
		}
		for (var j = 0; j < recipientsInfo.length; j++) {
			var aux = [];
			aux.push(recipientsInfo[j].name ? recipientsInfo[j].name : '-');
			data.distributionList.push(aux);
		}
		data.messagesSent = recipientsInfo.length;
	}

	// checking if user has permission to write in the current record
	var crisisUtils = new CIRSituationUtils();
	if (data.sys_id != -1) {
		var grTask = new GlideRecordSecure(data.tables.TASK_EXECUTION);
		if (grTask.get(data.sys_id)) {
			if (grTask.getValue('state') == '4') {
				data.hideCloseTask = false;
			} else {
				data.hideCloseTask = grTask.canWrite();
			}
		}
	}

	/* function called when the Send Message button is clicked
	 *  
	 *  @param {object} message - object built on the sendMessage function on the client script
	 */
	function sendMessage(message) {
		var crisisUtils = new CIRSituationUtils();
		var infoMessage = crisisUtils.SendMessageCrisisTask(message);
		if (infoMessage) {
			data.info_message = infoMessage;
		}
	}
})($sp, input, data, options, gs);]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>hugo.reis</sys_created_by>
        <sys_created_on>2020-06-24 07:50:34</sys_created_on>
        <sys_id>a58a1edadbe59810bf9ead8ed3961932</sys_id>
        <sys_mod_count>56</sys_mod_count>
        <sys_name>CIR Form (Security Process)</sys_name>
        <sys_package display_value="Corporate Incident Response" source="x_fru_cir">265c101f13ab44100b8670a76144b0a2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Corporate Incident Response">265c101f13ab44100b8670a76144b0a2</sys_scope>
        <sys_update_name>sp_widget_a58a1edadbe59810bf9ead8ed3961932</sys_update_name>
        <sys_updated_by>hugo.reis</sys_updated_by>
        <sys_updated_on>2020-11-17 10:05:12</sys_updated_on>
        <template><![CDATA[<div ng-if="data.isValid" class="panel-shift">
    <div class="" ng-if="!data.f._view.length && data.hideRelatedLists && data.emptyStateTemplate">
        <div class="empty-state-wrapper panel panel-default" ng-include="data.emptyStateTemplate"></div>
    </div>

    <div class="" ng-if="!data.f._view.length && data.hideRelatedLists && !data.emptyStateTemplate">
        <div class="panel panel-default">
            <div class="panel-heading"><span class="panel-title">{{data.f.title}}</span> <span
                    ng-if="::options.showFormView == 'true' && data.f.view != ''">[{{data.f.view_title}} view]</span>
            </div>
            <div class="panel-body wrapper-lg text-center">
                ${No elements to display}
            </div>
        </div>
    </div>

    <div ng-show="isPageReady" class="panel panel-default" ng-if="::data.f._view.length || !data.hideRelatedLists">
        <div class="panel-heading" ng-if="data.f.title.length && c.data.table!='x_fru_cir_situation_task_execution'"
            sp-context-menu="getUIActionContextMenu(event)">
            <span class="panel-title" aria-label="{{data.f.title}}">{{data.f.title}}</span> <span
                ng-if="::options.showFormView == 'true' && data.f.view != ''">[{{data.f.view_title}} view]</span>
            <div ng-if="::attachmentHandler && data.canAttach" title="{{::data.addAttachmentMsg}}"
                class="pull-right attachment-button">
                <sp-attachment-button></sp-attachment-button>
            </div>
        </div>
        <div class="panel-body">
            <!-- performance debug -->
            <div ng-if="data.show_sql">
                <div class="comment">
                    <span
                        ng-if="datdata:image/pjpeg;base64,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.f._perf.sql_count">${SQL
                        Statements {{data.f._perf.sql_count}}}, </span>
                    <span>${Time {{data.f._perf.time}}}</span>
                </div>
                <div ng-repeat="s in data.f._perf.sql" class="{{s.type}}">
                    {{s.statement}}
                </div>

            </div>

            <div id="buttons" ng-if="c.data.table=='x_fru_cir_situation_task_execution'">
                <button id="sendMessage" ng-if="!data.newRecord && !c.hideSendMessage" ng-click="c.sendMessage()"
                    class="btn btn-secondary action-btn">${cir_sit_send_message}</button>
                <button id="saveButton" ng-if="data.newRecord" type="submit"
                    ng-click="triggerUIAction(getPrimaryAction())" ng-disabled="submitting"
                    class="btn btn-primary action-btn"
                    gsft_id="{{::getPrimaryAction().sys_id ? getPrimaryAction().sys_id : ''}}">${cir_sit_add}</button>
                <button id="saveButton" ng-if="!data.newRecord && !c.hideAllButtons" type="save" ng-click="c.saveAndStay()" ng-disabled="submitting" class="btn btn-secondary action-btn">${cir_sit_save}</button> 	
                <button id="saveButton" ng-if="!data.newRecord && !c.hideAllButtons" type="submit"
                    ng-click="triggerUIAction(getPrimaryAction())" ng-disabled="submitting"
                    class="btn btn-primary action-btn"
                    gsft_id="{{::getPrimaryAction().sys_id ? getPrimaryAction().sys_id : ''}}">${cir_sit_save_and_close}</button>

            </div>
            <!-- attachments -->
            <sp-attachment-manager table="::data.table" sys-id="data.f._attachmentGUID" omit-edit="::!data.canAttach">
            </sp-attachment-manager>
            <!-- form -->
            <div>
                <sp-model form_model="data.f" mandatory="mandatory"></sp-model>
            </div>
            <div
                ng-if="c.data.table=='x_fru_cir_situation_task_execution' && c.showMessageDetails">
                <h4>${cir_sit_message_details}</h4>
                <table style="width: 100%">
                    <tr>
                        <th>${cir_sit_notifications_send}: {{data.messagesSent}}</th>
                    </tr>
                    <tr>
                    </tr>
                    <tr>
                        <th ng-repeat="label in c.data.labels">{{label}}</th>
                    </tr>
                    <tr ng-repeat="record in c.data.distributionList">
                        <td ng-repeat="value in record track by $index">
                            {{value}}
                        </td>
                    </tr>
                </table>
            </div>
            <!--THIS DIV IS HIDED WHEN OPENING A CRISIS TASK EXECUTION FORM-->
            <div class="panel-footer" ng-if="c.data.table!='x_fru_cir_situation_task_execution'">
                <!--<button ng-click="triggerUIAction(action)" ng-disabled="submitting" ng-repeat="action in getUIActions('button')" class="btn action-btn" ng-class="::getButtonClass(action)" gsft_id="{{::action.sys_id}}">{{action.name}}</button>-->
                <span>{{status}}</span>
                <button ng-if="getPrimaryAction()" type="submit" ng-click="triggerUIAction(getPrimaryAction())"
                    ng-disabled="submitting" class="btn btn-primary action-btn pull-right"
                    gsft_id="{{::getPrimaryAction().sys_id ? getPrimaryAction().sys_id : ''}}">${cir_sit_save} <span
                        ng-if="saveButtonSuffix">(${{{saveButtonSuffix}}})</span></button>
                <div style="clear: both;"></div>
                <div ng-if="mandatory.length" class="alert alert-info" style="margin-top: .5em" aria-live="polite"
                    aria-atomic="true">
                    <span ng-if="mandatory.length > 0">${cir_required_info} </span>
                    <span ng-repeat="f in mandatory" class="label sc-field-error-label" ng-bind="f.label"></span>
                </div>
            </div>


        </div>
    </div>
</div>]]></template>
    </sp_widget>
</record_update>
