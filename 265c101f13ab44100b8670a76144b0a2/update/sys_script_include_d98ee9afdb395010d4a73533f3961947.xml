<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_fru_cir.CIRKpiCalculationFP</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>CIRKpiCalculationFP</name>
        <script><![CDATA[var CIRKpiCalculationFP = (function() {
    var kpiCalculationHelper = {};

    var initialize = function(helper) {
        kpiCalculationHelper = helper;
    };

    var HOURS_WORKED = 1000000;

    /**
     * Function calculate the LTIF
     *
     * @param {Object} kpiObj - JSON object with all the related data necessary to create the record
     * @param {String} startDate - Start date for fething the records
     * @param {String} endDate - End date for fething the records
     * @return {Number} - Calculation for the LTIF
     */
    var calculateLtif = function(objKpi, startDate, endDate) {
        var ltiCount = kpiCalculationHelper.GetLTIForPeriod(startDate, endDate, objKpi.locationSysId, objKpi
            .calculationTypeName);
        return ((ltiCount / objKpi.workingHoursValue) * HOURS_WORKED);
    };

    /**
     * Function calculate the LTIF V1
     *
     * @param {Object} kpiObj - JSON object with all the related data necessary to create the record
     * @param {String} startDate - Start date for fething the records
     * @param {String} endDate - End date for fething the records
     * @return {Number} - Calculation for the LTIF V1
     */
    var calculateLtifV1 = function(objKpi, startDate, endDate) {
        var numMedicalTreatment = kpiCalculationHelper.GetMedicalTreatmentForPeriod(startDate, endDate,
            objKpi.locationSysId);
        var ltiCount = kpiCalculationHelper.GetLTIForPeriod(startDate, endDate, objKpi.locationSysId, objKpi
            .calculationTypeName);
        return (((parseInt(ltiCount) + parseInt(numMedicalTreatment)) / objKpi.workingHoursValue) *
            HOURS_WORKED);
    };

    /**
     * Function calculate the LTIF SR
     *
     * @param {Object} kpiObj - JSON object with all the related data necessary to create the record
     * @param {String} startDate - Start date for fething the records
     * @param {String} endDate - End date for fething the records
     * @return {Number} - Calculation for the LTIF SR
     */
    var calculateLtifSr = function(objKpi, startDate, endDate) {
        var totalTimeLost = kpiCalculationHelper.GetSumOfTotalTimeLostForPeriod(startDate, endDate, objKpi
            .locationSysId);
        return kpiVal = ((totalTimeLost / objKpi.workingHoursValue) * 1000);
    };

    /**
     * Function get all the active calculaton types data
     *
     * @return {Array} - Array with all the active calculation types data
     */
    var getCalculationTypes = function() {
        return kpiCalculationHelper.GetCalculationTypes();
    };

    var kpiCalculator = {};
    kpiCalculator[CIRConstants.KpiCalculationTypes.LTIF] = calculateLtif;
    kpiCalculator[CIRConstants.KpiCalculationTypes.LTIF_V2] = calculateLtif;
    kpiCalculator[CIRConstants.KpiCalculationTypes.LTIF_V1] = calculateLtifV1;
    kpiCalculator[CIRConstants.KpiCalculationTypes.LTI_SR] = calculateLtifSr;

    var CIRKpiCalculationFP = Class.create();
    CIRKpiCalculationFP.prototype = {
        initialize: initialize,

        KpiCalculator: kpiCalculator,
        GetCalculationTypes: getCalculationTypes
    };

    return CIRKpiCalculationFP;
})();]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>Jorge.Diogo@fruitionpartners.pt</sys_created_by>
        <sys_created_on>2020-07-10 12:01:27</sys_created_on>
        <sys_id>d98ee9afdb395010d4a73533f3961947</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>CIRKpiCalculationFP</sys_name>
        <sys_package display_value="Corporate Incident Response" source="x_fru_cir">265c101f13ab44100b8670a76144b0a2</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Corporate Incident Response">265c101f13ab44100b8670a76144b0a2</sys_scope>
        <sys_update_name>sys_script_include_d98ee9afdb395010d4a73533f3961947</sys_update_name>
        <sys_updated_by>jorge.diogo@fruitionpartners.pt</sys_updated_by>
        <sys_updated_on>2020-07-10 13:44:45</sys_updated_on>
    </sys_script_include>
</record_update>
