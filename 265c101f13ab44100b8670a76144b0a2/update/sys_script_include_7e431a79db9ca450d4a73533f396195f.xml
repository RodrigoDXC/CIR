<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_fru_cir.CIRAssmtActivationFP</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>CIRAssmtActivationFP</name>
        <script><![CDATA[var CIRAssmtActivationFP = function() {
    /**
     * Function to activate or deactivate an Assessment object and it 's connected Catalog objects.
     *
     * @param {String} tableName - Current table name
     * @param {String} currentId - SysID of the current record
     * @param {Boolean} activate - True to activate the Assessment object, false to deactivate it
     * @param {Boolean} published - True if it is an Assessment Definition and is published, false otherwise
     * @return {void}
     */
    var activateAssessmentObject = function(tableName, currentId, activate, published) {
        var grAssessmentObj = new GlideRecord(tableName);
        if(!grAssessmentObj.get(currentId)) {
            return '';
        }
        grAssessmentObj.setValue('active', activate);
        if(!activate && published) {
            grAssessmentObj.setValue('published', false);
        }
        grAssessmentObj.update();

        if(activate === false && tableName === CIRConstants.Tables.ASSESSMENT_CHOICE) {
            new CIRAssmtModel().RemoveCatalogObjects(grAssessmentObj);
        }
    };

    /**
     * Function to get the message for the popup
     *
     * @param {String} tableName - Current table name
     * @param {Boolean} published - True if it is an Assessment Definition and is published, false otherwise
     * @param {Boolean} activate - True if the user is activating the assessment objects, false otherwise
     * @return {String} - String with the message to show to the user in the popup
     */
    var getActivateDeactivateAssessmentMessage = function(tableName, published, activate) {
        var tableNameNoPrefix = tableName.replace('x_fru_cir_', '');
        var MESSAGE_PREFIX = activate ? 'cir_assmt_activate_' : 'cir_assmt_deactivate_';
        if(published) {
            tableNameNoPrefix += '_published';
        }
        return gs.getMessage(MESSAGE_PREFIX + tableNameNoPrefix);
    };
	
	/**
     * Function to deactivate by cascade the subset of records related
     *
     * @param {String} tableName - Current table name
     * @param {String} currentId - Id of the deactivate object
     * @param {String} field - Field to coalesce
     * @return {void}
     */
	var deactivateChildRecords = function(tableName, currentId, field){
		var grChild = new GlideRecord(tableName);
		grChild.addQuery(field, currentId);
		grChild.query();
		while(grChild.next()){
			activateAssessmentObject(tableName, grChild.getUniqueValue(), false);
		}
		
	};

    return {
        ActivateAssessmentObject: activateAssessmentObject,
        GetActivateDeactivateAssessmentMessage: getActivateDeactivateAssessmentMessage,
		DeactivateChildRecords : deactivateChildRecords
    };
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>Jorge.Diogo@fruitionpartners.pt</sys_created_by>
        <sys_created_on>2020-11-06 10:50:39</sys_created_on>
        <sys_id>7e431a79db9ca450d4a73533f396195f</sys_id>
        <sys_mod_count>15</sys_mod_count>
        <sys_name>CIRAssmtActivationFP</sys_name>
        <sys_package display_value="Corporate Incident Response" source="x_fru_cir">265c101f13ab44100b8670a76144b0a2</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Corporate Incident Response">265c101f13ab44100b8670a76144b0a2</sys_scope>
        <sys_update_name>sys_script_include_7e431a79db9ca450d4a73533f396195f</sys_update_name>
        <sys_updated_by>Jorge.Diogo@fruitionpartners.pt</sys_updated_by>
        <sys_updated_on>2020-11-10 13:52:58</sys_updated_on>
    </sys_script_include>
</record_update>
