<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_sg_write_back_action_item">
    <sys_sg_write_back_action_item action="INSERT_OR_UPDATE">
        <description/>
        <execution_script><![CDATA[(function WriteBackAction(input) {
	
	var grExpenseLines = new GlideRecord(CIRConstants.Tables.EXPENSE_LINE);
	grExpenseLines.addQuery('expense_id', input.sys_id);
	grExpenseLines.addQuery('type.evidence_required', true);
	grExpenseLines.query();
	
	while (grExpenseLines.next()) {
		
		var grAttachments = new GlideRecord('sys_attachment');
		grAttachments.addQuery('table_sys_id', grExpenseLines.getUniqueValue());
		grAttachments.query();
		
		if (!grAttachments.next()) {
			gs.addErrorMessage(gs.getMessage('cir_mobile_invoice_missing'));
			return;
		}
	}
	
	var grExpenses = new GlideRecord(CIRConstants.Tables.EXPENSE);
	if (grExpenses.get(input.sys_id)) {
		grExpenses.setValue('status', '2');
		grExpenses.update();
	}
 
})(input);]]></execution_script>
        <name>Submit Expense</name>
        <query_condition/>
        <sys_class_name>sys_sg_write_back_action_item</sys_class_name>
        <sys_created_by>Paulo.Gomes@fruitionpartners.pt</sys_created_by>
        <sys_created_on>2020-08-03 16:31:10</sys_created_on>
        <sys_id>fdd112dbdb5e5050d4a73533f3961905</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Submit Expense</sys_name>
        <sys_package display_value="Corporate Incident Response" source="x_fru_cir">265c101f13ab44100b8670a76144b0a2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Corporate Incident Response">265c101f13ab44100b8670a76144b0a2</sys_scope>
        <sys_update_name>sys_sg_write_back_action_item_fdd112dbdb5e5050d4a73533f3961905</sys_update_name>
        <sys_updated_by>Paulo.Gomes@fruitionpartners.pt</sys_updated_by>
        <sys_updated_on>2020-08-03 16:31:10</sys_updated_on>
        <table/>
        <template/>
        <type>script</type>
        <use_current_record_as_condition>true</use_current_record_as_condition>
        <use_fields_for_ref_lookup>false</use_fields_for_ref_lookup>
    </sys_sg_write_back_action_item>
    <sys_translated_text action="delete_multiple" query="documentkey=fdd112dbdb5e5050d4a73533f3961905"/>
</record_update>
