<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function ($scope, spModal, spUtil, $uibModal) {
	var c = this;
	var objectToEdit = {};

	c.addEvent = function() {
		$scope.data.widgetFormTemplateOptions.table = c.data.table;
		$scope.data.widgetFormTemplateOptions.view = c.data.view;
		$scope.data.widgetFormTemplateOptions.sys_id = '-1';
		spUtil.get($scope.data.widgetForFormTemplate, $scope.data.widgetFormTemplateOptions).then(function(response) {
			$scope.data.widgetFormTemplate = response;

			$scope.modalInstance = $uibModal.open({
				templateUrl: c.data.templateForm,
				scope: $scope,
				size: 'lg'
			});
		});
	}
	
	 $scope.$on("spModel.uiActionComplete", function(evt, response) {
        $scope.closeModal();
    });
	
	$scope.closeModal = function() {
        $scope.modalInstance.close();
    }

	spUtil.recordWatch($scope, c.data.table, 'investigation=' + c.data.parent, function() {
		c.server.update();
	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.panel-heading {&#13;
  padding-left: 8px;&#13;
}&#13;
&#13;
.panel-body {&#13;
  padding: 0;&#13;
  height: 590px;&#13;
  overflow-y: auto;&#13;
}&#13;
&#13;
.panel-buttons {&#13;
  height: 15px;&#13;
}&#13;
&#13;
.btn-event {&#13;
  position: absolute;&#13;
  right: 15px;&#13;
  margin: 10px;&#13;
}&#13;
&#13;
thead {&#13;
  border-bottom: 1px solid #ddd;&#13;
}&#13;
&#13;
table {&#13;
  border-collapse: collapse;&#13;
  width: 100%;&#13;
}&#13;
&#13;
th, td {&#13;
  text-align: left;&#13;
  padding: 8px;&#13;
}&#13;
&#13;
th {&#13;
  border: 1px solid #ddd;&#13;
  color: $brand-primary;&#13;
  position: sticky;&#13;
  top: 0;&#13;
  background: white;&#13;
  border-collapse: collapse;&#13;
}&#13;
&#13;
table {&#13;
  border: 0;&#13;
}&#13;
&#13;
tr {&#13;
  border-bottom: solid 1px #dee5e7;&#13;
}&#13;
&#13;
td {&#13;
  height: 56px;&#13;
}&#13;
&#13;
th:first-child {&#13;
  border-left: 0;&#13;
}&#13;
&#13;
th:last-child {&#13;
  border-right: 0;&#13;
}&#13;
&#13;
tr:first-child {&#13;
  border: 0;&#13;
}&#13;
&#13;
tr:last-child {&#13;
  border-collapse: collapse;&#13;
}&#13;
&#13;
tr:nth-child(even) {&#13;
  background-color: #f9f9f9;&#13;
}</css>
        <data_table>sp_instance_table</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>cir-ciri-event-timeline</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>CIR CIRI Event Timeline</name>
        <option_schema>[{"name":"table","section":"Data","default_value":"x_fru_cir_event_timeline","label":"Table","type":"string"},{"name":"fields","section":"Data","default_value":"sequence,occurred,description","label":"Fields","type":"string"}]</option_schema>
        <public>false</public>
        <roles>x_fru_cir.investigator</roles>
        <script><![CDATA[(function() {
    data.parent = input && input.parentId ? input.parentId : $sp.getParameter('sys_id');
    data.table = options.table;
    data.fields = options.fields.split(',');
    data.records = new CIRRiskManagementUtils().GetInvestigationEvents(data.table, data.fields, data.parent);
    data.headers = [];
    data.view = 'portal_view';

    data.templateForm = 'cirCiriEventTimelineTemplate';
    data.widgetForFormTemplate = 'widget-form';
    data.widgetFormTemplateOptions = {
        table: '',
        sys_id: '',
        view: '',
        _fields: {
            investigation: {
                value: data.parent,
                readonly: true
            }
        }
    };

    data.no_records = gs.getMessage('No records found');

    var fieldsAux = $sp.getFields(new GlideRecord(data.table), options.fields.toString());
    fieldsAux.forEach(function(field) {
        data.headers.push(field.label);
    });
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>Jorge.Diogo@fruitionpartners.pt</sys_created_by>
        <sys_created_on>2020-06-26 09:09:58</sys_created_on>
        <sys_id>f76005871b61101024c896ce0a4bcb4d</sys_id>
        <sys_mod_count>10</sys_mod_count>
        <sys_name>CIR CIRI Event Timeline</sys_name>
        <sys_package display_value="Corporate Incident Response" source="x_fru_cir">265c101f13ab44100b8670a76144b0a2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Corporate Incident Response">265c101f13ab44100b8670a76144b0a2</sys_scope>
        <sys_update_name>sp_widget_f76005871b61101024c896ce0a4bcb4d</sys_update_name>
        <sys_updated_by>Jorge.Diogo@fruitionpartners.pt</sys_updated_by>
        <sys_updated_on>2020-06-29 08:55:12</sys_updated_on>
        <template><![CDATA[<div class="panel-group">
  <div class="panel panel-default">

    <div class="panel-body">
      <table ng-if="data.records.length > 0">
        <thead>
          <tr>
            <th ng-repeat="header in c.data.headers">
              {{ header }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="record in c.data.records">
            <td ng-repeat="value in record.data track by $index">
              {{ value }}
            </td>
          </tr>
        </tbody>

      </table>
      <div style="margin:20px" ng-if="data.records.length == 0">
        <span style="font-weight: 500;">{{ data.no_records }}</span>
      </div>     
    </div>
  </div>

  <div class="panel-buttons">
    <button ng-disabled="c.data.parent_state==1" ng-click="c.addEvent()" class="btn btn-primary action-btn btn-event">${Add Event}</button>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
