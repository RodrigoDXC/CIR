<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_push_notif_msg_content">
    <sys_push_notif_msg_content action="INSERT_OR_UPDATE">
        <name>CIR Situation notification content</name>
        <push_app display_value="ServiceNow Mobile Application">05ed2fb177002300258da2e2c81061c2</push_app>
        <script><![CDATA[(function buildJSON(/*GlideRecord*/ current, /*String*/ message, /*Object*/ attributes) {

	var number = '';
	var description = '';
	var msgSysId = '';
	
	var docId = getDocId();
	
	
	var msgRecipients = new GlideRecord(CIRConstants.Tables.MSG_EXEC_RECIPIENT);
	msgRecipients.addQuery("step_message_execution", current.sys_id);
	msgRecipients.query();

	if (msgRecipients.next()) {		
		msgSysId = msgRecipients.getUniqueValue();

		//var layoutFieldGenerator = new global.NotificationLayoutFieldGenerator();
		//number = layoutFieldGenerator.layoutField(msgRecipients.getTableName(), msgRecipients.sys_id, "step_message_execution.number");
		//description = layoutFieldGenerator.layoutField(msgRecipients.getTableName(), msgRecipients.sys_id, "step_message_execution.short_description");
	}

	var json = {};

	json = {
		"aps" : {
			"sound" : "default"
		},
		"Redirection" : {
			"Title" : "Messages Received",
			"To" : "Embedded",
			"Destination": {
				"DocumentId": docId
			}
		},
		"Layout" : {
			"Identifier" : number,
			"Description" : description
		}
	};

	return json;
	
	function getDocId() {
		var docId = '';
		if(current.response_plan_step.feedback) {
			
			docId = "d0f63249db37085049959a82ca96190b"; // sys_id of the message recipients applet
			
		} else {
			var className = current.response_plan_step.sys_class_name;
			
			if(className == CIRConstants.Tables.RESP_PLAN_EXEC_STEP_MSG) {
				
				if(current.situation){
					docId = '80aed60ddbb3085049959a82ca9619c6'; // sys_id of the crisis rooms applet
					
				} else {
					docId = 'e3da66c9dbf3085049959a82ca961941'; // sys_id of the response plans applet
					
				}
			} else {
				docId = "d0f63249db37085049959a82ca96190b"; // sys_id of the message recipients applet
			}
		}
		
		return docId;
	}
	
})(current, message, attributes);]]></script>
        <sys_class_name>sys_push_notif_msg_content</sys_class_name>
        <sys_created_by>hugo.reis</sys_created_by>
        <sys_created_on>2020-03-25 09:18:45</sys_created_on>
        <sys_id>404742411b730850df7e43f4bd4bcbc8</sys_id>
        <sys_mod_count>5</sys_mod_count>
        <sys_name>CIR Situation notification content</sys_name>
        <sys_package display_value="Corporate Incident Response" source="x_fru_cir">265c101f13ab44100b8670a76144b0a2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Corporate Incident Response">265c101f13ab44100b8670a76144b0a2</sys_scope>
        <sys_update_name>sys_push_notif_msg_content_404742411b730850df7e43f4bd4bcbc8</sys_update_name>
        <sys_updated_by>Antonio.Carvalho@fruitionpartners.pt</sys_updated_by>
        <sys_updated_on>2020-04-01 13:57:13</sys_updated_on>
    </sys_push_notif_msg_content>
</record_update>
